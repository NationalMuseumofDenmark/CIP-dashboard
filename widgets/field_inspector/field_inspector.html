<!-- TODO: Loading these two script breaks the piechart-widget -->
<!-- <script src="vendor/jqplot/jquery.min.js"></script> -->
<script src="vendor/jqplot/jquery.jqplot.min.js"></script>
<script src="vendor/jqplot/plugins/jqplot.barRenderer.min.js"></script>
<script src="vendor/jqplot/plugins/jqplot.categoryAxisRenderer.min.js"></script>
<script src="vendor/jqplot/plugins/jqplot.pointLabels.min.js"></script>
<script src="vendor/jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>
<script src="vendor/jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
<script src="vendor/jqplot/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>
<script>
requirejs(['jquery',
    // 'jqplot',
//   'jqplot.barRenderer.min',
//   'jqplot.categoryAxisRenderer.min',
//   'jqplot.pointLabels.min',
//   'jqplot.dateAxisRenderer.min',
//   'jqplot.canvasTextRenderer.min',
//   'jqplot.canvasAxisTickRenderer.min'
], function($) {

  var options = {
    // The "seriesDefaults" option is an options object that will
    // be applied to all series in the chart.
    seriesDefaults:{
      renderer:$.jqplot.BarRenderer,
      rendererOptions: {fillToZero: true}
    },
    // Custom labels for the series are specified with the "label"
    // option on the series option.  Here a series option object
    // is specified for each series.
    //// series:[
    ////     {label:'Hotel'},
    ////     {label:'Event Regristration'},
    ////     {label:'Airfare'}
    //// ],
    // Show the legend and put it outside the grid, but inside the
    // plot container, shrinking the grid to accomodate the legend.
    // A value of "outside" would not shrink the grid and allow
    // the legend to overflow the container.
    legend: {
      show: false
      // placement: 'outsideGrid'
    },
    axes: {
      // Use a category axis on the x axis and use our custom ticks.
      xaxis: {
        renderer: $.jqplot.CategoryAxisRenderer,
        tickRenderer: $.jqplot.CanvasAxisTickRenderer,
        ticks: [],
        tickOptions: {
          angle: -30,
          fontSize: '10pt'
        }
      },
      // Pad the y axis just a little so bars can get close to, but
      // not touch, the grid boundaries.  1.2 is the default padding.
      yaxis: {
        // label: 'Count',
        min: 0,
        pad: 1.05
        //tickOptions: {formatString: '$%d'}
      }
    }
  }

  $('#field-inspector-select').change(function() {
    var $optionSelected = $($("option:selected", this));
    var field = $optionSelected.data('field');
    var uuid = field.key;

    var values = [];
    var counts = [];
    var stats = CIPdashboard.stats['stats'];
    for (var value in stats[uuid]['values']) {
      var count = stats[uuid]['values'][value];
      counts.push(count);
      values.push(value);
    }
    console.log(counts);
    console.log(values);

    // counts.push(stats[uuid]['empty_values']);
    // values.push('(tomt felt)');
    // plot1.series[0].data = counts;
    // plot1.axes.xaxis.ticks = values;
    // plot1.replot({resetAxes: true, data:[counts], axes:{xaxis:{ticks:values}}});

    // Alternative replot
    $('div#chart-field-inspector').html('');
    if (values.length > 0) {
      options.title = stats[uuid]['name'];
      options.axes.xaxis.label = stats[uuid]['type'];

      options.axes.xaxis.ticks = values;
      var plot1 = $.jqplot('chart-field-inspector', [counts], options);
    }
  });
});
</script>
<script>
  var getPercentage = function(percentage) {
    return (percentage * 100).toFixed(1) + '%';
  }
  var getFilledPercentage = function(uuid) {
    var stats_field = CIPdashboard.stats['stats'][uuid];
    console.log(stats_field['empty_values']);
    var empty_percentage = (stats_field['zero_length_values'] + stats_field['empty_values']) / CIPdashboard.stats['total_count'];
    var filled_percentage = 1.0 - empty_percentage;
    return getPercentage(filled_percentage);
  }

  var layout = CIPdashboard.stats['layout']['fields'];
  for (var i = 0; i < layout.length; i++) {
    var $option = $('<option>' + layout[i]['name'] + '</option>');
    $option.data('field', layout[i]);
    $('#field-inspector-select').append($option);
  }
  $('#field-inspector-select').change(function() {
    var $optionSelected = $($("option:selected", this));
    var field = $optionSelected.data('field');
    console.log(field);
    $('#field-inspector-uuid').text(field.key);
    $('#field-inspector-percentage').text(getFilledPercentage(field.key));
  });
</script>

<h1>Field inspector</h1>
<select id="field-inspector-select"></select>
<ul>
  <li>UUID: <span id="field-inspector-uuid"></span></li>
  <li>Udfyldelsesprocent: <span id="field-inspector-percentage" class="large-percentage"></span></li>
</ul>
<div id="chart-field-inspector" style="width:500px; height:180px; float:right;"></div>
<style>
#field-inspector-select {
  float: right;
}
</style>
